{% load static %}
<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- Required meta tags -->
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>编程页面</title>
        <!-- plugins:css -->
        <link rel="stylesheet" href="{% static 'student_app/css/materialdesignicons.min.css' %}">
        <link rel="stylesheet" href="{% static 'student_app/css/vendor.bundle.base.css' %}">
        <!-- endinject -->
        <!-- plugin css for this page -->
        <link rel="stylesheet" href="{% static 'student_app/css/dataTables.bootstrap4.css' %}">
        <!-- End plugin css for this page -->
        <!-- inject:css -->
        <link rel="stylesheet" href="{% static 'student_app/css/style.css' %}">
        <!-- endinject -->
        <link rel="shortcut icon" href="{% static 'student_app/photo/favicon.png' %}">
        <link rel="stylesheet" href="{% static 'student_app/css/coding.css' %}">

        <style type="text/css">/* Chart.js */
            @keyframes chartjs-render-animation{
                from{opacity:.99}
                to{opacity:1}}
            .chartjs-render-monitor{animation:chartjs-render-animation 1ms}
            .chartjs-size-monitor,
            .chartjs-size-monitor-expand,
            .chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}
            .chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}
            .chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}
        </style>
        <script>
        function redirectToHome() {
            window.location.href = "/student/home/"
        }

        function redirectToPractice() {
            window.location.href = "/student/practice/";
        }

        function redirectToTest() {
            window.location.href = "/student/test/";
        }

        function redirectToProfile() {
            window.location.href = "/student/profile/"
        }

    </script>
    </head>
<!-- 引入Monaco编辑器的静态文件 -->
    <script src="{% static 'node_modules/monaco-editor/min/vs/loader.js' %}"></script>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="navbar-brand-wrapper d-flex justify-content-center">
        <div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">
          <a class="navbar-brand brand-logo" href="#"><img src="{% static 'student_app/photo/logo.svg' %}" alt="logo"></a>
          <a class="navbar-brand brand-logo-mini" href="#"><img src="{% static 'student_app/photo/logo-mini.svg' %}" alt="logo"></a>
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-sort-variant"></span>
          </button>


        </div>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">


        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="redirectToHome()">
              <i class="mdi mdi-home menu-icon"></i>
              <span class="menu-title">我的作业</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#" onclick="redirectToPractice()" aria-expanded="false" aria-controls="ui-basic">
              <i class="mdi mdi-circle-outline menu-icon"></i>
              <span class="menu-title">我的练习</span>
              <i class="menu-arrow"></i>
            </a>

          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="redirectToTest()">
              <i class="mdi mdi-view-headline menu-icon"></i>
              <span class="menu-title">我的考试</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="mdi mdi-chart-pie menu-icon"></i>
              <span class="menu-title">学情分析</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="redirectToProfile()">
              <i class="mdi mdi-grid-large menu-icon"></i>
              <span class="menu-title">个人中心</span>
            </a>
          </li>
        </ul>
      </nav>


      <!-- partial -->
  <div class="main-panel">
  <div class="container-flex">
          <!-- Left side (Problem Info and Submission Record) -->
          <div class="problem-container">
            <!-- Toggle buttons -->
            <div class="toggle-buttons">
              <button id="infoBtn" onclick="showPanel('problem-info')">题目信息</button>
              <button id="recordBtn" onclick="showPanel('submission-record')">提交记录</button>
            </div>
            <!-- Problem Info Panel -->
            <div id="problem-info" class="panel">
              <!-- 题目信息内容 -->
              <p>题目信息</p>
            </div>
            <!-- Submission Record Panel -->
            <div id="submission-record" class="panel" style="display: none;">
              <!-- 提交记录内容 -->
              <p>提交记录</p>
            </div>
          </div>
        <!-- Right side (Editor and Debugger) -->
          <div class="editor-container" id="editor">
            <!-- Monaco编辑器将在这里初始化 -->

              <div id="debugger" class="debugger">
            <!-- 调试信息 -->
               <p>运行信息</p>
              </div>
          </div>

                       <!-- 表单 -->
            <form id="codeForm" action="{% url 'student_app:run-cpp' %}" method="post">
                {% csrf_token %}
                <textarea id="codeTextArea" style="display: none;"></textarea> <!-- 隐藏 textarea -->
                <input type="hidden" name="code" id="hiddenCodeInput">
                <!-- 使用之前按钮的样式和位置，但移除了 onclick 属性 -->
                <button class="debugger-button" id="runCode" type="submit">提交</button>
            </form>


  </div>
  </div>
    </div>
  </div>






  <!-- container-scroller -->

  <!-- plugins:js -->
  <script type="text/javascript" src="{% static 'student_app/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <script type="text/javascript" src="{% static 'student_app/js/Chart.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'student_app/js/jquery.dataTables.js' %}"></script>
  <script type="text/javascript" src="{% static 'student_app/js/dataTables.bootstrap4.js' %}"></script>
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script type="text/javascript" src="{% static 'student_app/js/off-canvas.js' %}"></script>
  <script type="text/javascript" src="{% static 'student_app/js/hoverable-collapse.js' %}"></script>
  <script type="text/javascript" src="{% static 'student_app/js/template.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script type="text/javascript" src="{% static 'student_app/js/dashboard.js' %}"></script>
  <script type="text/javascript"  src="{% static 'student_app/js/data-table.js' %}"></script>
  <script type="text/javascript"  src="{% static 'student_app/js/jquery.dataTables(1).js' %}"></script>
  <script type="text/javascript" src="{% static 'student_app/js/dataTables.bootstrap4(1).js' %}"></script>
  <!-- End custom js for this page-->
  <script src="{% static 'student_app/js/jquery.cookie.js' %}" type="text/javascript"></script>
<script src="{% static 'student_app/js/editor_setup.js' %}"></script>
<script>
    var editor;  // 定义全局变量以存储编辑器实例

    require.config({
        paths: {
            'vs': '{% static "node_modules/monaco-editor/min/vs" %}'
        }
    });

    require(['vs/editor/editor.main'], function() {
        editor = monaco.editor.create(document.getElementById('editor'), {
            value: 'console.log("Hello, world!")',
            language: 'javascript',
            theme: 'vs-light'
        });
    });
</script>

<script>
    // 提交代码的函数，使用 AJAX
    function submitCode() {
        var code = editor.getValue();  // 从 Monaco 编辑器获取代码

        fetch("{% url 'student_app:run-cpp' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'),
            },
            body: JSON.stringify({ code: code }),
        })
        .then(response => response.json())
        .then(data => {
            // 显示 debugger 窗口并更新内容
            var debuggerElement = document.getElementById('debugger');
            debuggerElement.style.display = 'block'; // 确保 debugger 是可见的
            debuggerElement.innerHTML = `<p>输出: ${data.output}</p><p>错误: ${data.error}</p>`;  // 根据返回的数据结构调整
        })
        .catch(error => console.error('Error:', error));
    }

    // 绑定事件处理器到表单提交和按钮点击事件
    document.getElementById('codeForm').addEventListener('submit', function(event) {
        event.preventDefault();  // 阻止表单的默认提交行为
        submitCode();  // 调用函数提交代码
    });

    document.getElementById('runCode').addEventListener('click', function(event) {
        event.preventDefault();  // 阻止按钮的默认行为
        submitCode();  // 调用函数提交代码
    });
</script>

<script>
    // 用于获取 CSRF token 的辅助函数
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>





</body></html>