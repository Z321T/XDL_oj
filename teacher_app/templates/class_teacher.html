{% load static %}
<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>班级管理</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="{% static 'teacher_app/css/materialdesignicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'teacher_app/css/vendor.bundle.base.css' %}">
    <!-- endinject -->
    <!-- plugin css for this page -->
    <link rel="stylesheet" href="{% static 'teacher_app/css/dataTables.bootstrap4.css' %}">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="{% static 'teacher_app/css/style.css' %}">
    <!-- endinject -->
    <link rel="shortcut icon" href="{% static 'teacher_app/photo/favicon.png' %}">

    <style type="text/css">/* Chart.js */
        @keyframes chartjs-render-animation{
            from{opacity:.99}
            to{opacity:1}}
        .chartjs-render-monitor{animation:chartjs-render-animation 1ms}
        .chartjs-size-monitor,
        .chartjs-size-monitor-expand,
        .chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}
        .chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}
        .chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}
    </style>
    <script>
        function redirectToHome() {
            window.location.href = "/teacher/home/"
        }

        function redirectToNotice() {
            window.location.href = "/teacher/notice/";
        }

        function redirectToTest() {
            window.location.href = "/teacher/test/";
        }

        function redirectToProfile() {
            window.location.href = "/teacher/profile/"
        }

        function redirectToRepository() {
            window.location.href = "/teacher/repository/"
        }

        function redirectToClass() {
            window.location.href = "/teacher/class/"
        }
    </script>
    <style>
        .content-container {
              position: relative; /* 设置相对定位 */
              left:250px;
              width:60%; /* 固定宽度 */

              height: 800px; /* 固定高度 */
              border: 2px solid purple; /* 边框，以便内容窗口可见 */
            border-radius: 10px;
        }

.content-window {
    display: flex; /* 使用Flexbox布局 */
  align-items: start; /* 使表格和控制按钮顶部对齐 */
  width: 90%;
  height:90%; /* 充满容器 */
    max-height: 1200px; /* 设置表格的最大高度 */
  overflow-y: auto; /* 如果内容超出，显示滚动条 */
}
.table-container{
    display: flex;
    flex-direction: column;
    align-items: center;
    width:100%;

}


 .table-container table {
    width: 100%; /* 表格宽度充满容器 */
    height: 100%; /* 表格高度充满容器 */
    border-collapse: collapse; /* 合并表格边框 */
     overflow: auto;

  }
/* 为偶数行设置灰色背景 */
.table-container tr:nth-child(even) {
  background-color: #f2f2f2; /* 浅灰色背景 */
}

/* 为奇数行设置白色背景 */
.table-container tr:nth-child(odd) {
  background-color: #ffffff; /* 白色背景 */
}
.table-container tr {
  height: 30px; /* 设置每一行的固定高度为50px */
}
  .table-container th, .table-container td {
    border: 1px solid #ddd; /* 设置单元格边框 */
    text-align: left; /* 文本左对齐 */
    padding: 8px; /* 单元格内边距 */
  }


  /* 新增的标题样式 */
.table-title {
    width: 80px; /* 标题宽度充满容器 */
    margin-bottom: 5px; /* 在标题和表格之间添加一些空间 */
    font-size: 20px; /* 设置标题的字体大小 */
    font-weight: bold; /* 设置标题的字体加粗 */
}





.control-button-right {
  margin-top: 20px; /* 在按钮和表格之间添加一些空间 */
  padding: 10px 20px; /* 按钮内边距 */
  background-color: #007bff; /* 背景颜色 */
  color: #ffffff; /* 文本颜色 */
  border: none; /* 移除边框 */
  border-radius: 5px; /* 圆角边框 */
  cursor: pointer; /* 鼠标悬停时的指针样式 */
    right:2px;
    position: absolute;
  display: none; /* 默认不显示 */

}
#newClassButton {
  margin-top: 20px; /* 在按钮和表格之间添加一些空间 */
  padding: 10px 20px; /* 按钮内边距 */
  background-color: #007bff; /* 背景颜色 */
  color: #ffffff; /* 文本颜色 */
  border: none; /* 移除边框 */
  border-radius: 5px; /* 圆角边框 */
  cursor: pointer; /* 鼠标悬停时的指针样式 */
    right:2px;
    position: absolute;
}

#newClassButton:hover {
  background-color: #0056b3; /* 鼠标悬停时的背景颜色变化 */
}

    .button-class{
        border-radius: 10px;
        border: 1px solid purple;
        background-color: white;
        color: #0d111b;
        padding:5px 10px;
    }
    .button-class:hover{
        background-color: mediumpurple;
    }

/* 弹窗背景 */
.modal {
    display: none;
    position: fixed;
    z-index: 1; / Sit on top /
    left: 0;
    top: 0;
    width: 100%; / Full width /
    height: 100%; / Full height /
    overflow: auto; / Enable scroll if needed /
    background-color: rgb(0,0,0); / Fallback color /
    background-color: rgba(0,0,0,0.4); / Black w/ opacity */

}
/*弹窗内部样式 */
.modal-content {
background-color: #fefefe;
margin: 15% auto; / 15% from the top and centered /
padding: 20px;
border: 1px solid #888;
width: 30%; / Could be more or less, depending on screen size */
display: flex;
flex-direction: column;
align-items: center;
}

/* 关闭按钮样式 */
.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
}

.close:hover,
.close:focus {
color: black;
text-decoration: none;
cursor: pointer;
}

/* 拖拽区域样式 */
#dropArea {
width: 80%;
height: 100px;
border: 2px dashed #ccc;
border-radius: 5px;
display: flex;
align-items: center;
justify-content: center;
text-align: center;
margin: 10px 0;
    padding: 20px;
    cursor: pointer;
}
#dropArea.highlight {
border-color:blue;


background-color: #f0f8ff;
}



    </style>


</head>
<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="navbar-brand-wrapper d-flex justify-content-center">
        <div class="navbar-brand-inner-wrapper d-flex justify-content-between align-items-center w-100">
          <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
            <span class="mdi mdi-sort-variant"></span>
          </button>
        </div>
      </div>

    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="redirectToHome()">
              <i class="mdi mdi-home menu-icon"></i>
              <span class="menu-title">作业情况</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#" onclick="redirectToTest()" aria-expanded="false" aria-controls="ui-basic">
              <i class="mdi mdi-circle-outline menu-icon"></i>
              <span class="menu-title">考试情况</span>
              <i class="menu-arrow"></i>
            </a>

          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="redirectToNotice()">
              <i class="mdi mdi-chart-pie menu-icon"></i>
              <span class="menu-title">通知</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#" onclick="redirectToRepository()" aria-expanded="false" aria-controls="auth">
              <i class="mdi mdi-account menu-icon"></i>
              <span class="menu-title">我的题库</span>
              <i class="menu-arrow"></i>
            </a>

          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#" onclick="redirectToProfile()" aria-expanded="false" aria-controls="auth">
              <i class="mdi mdi-account menu-icon"></i>
              <span class="menu-title">个人中心</span>
              <i class="menu-arrow"></i>
            </a>

          </li>
            <li class="nav-item active">
            <a class="nav-link" data-toggle="collapse" href="#" onclick="redirectToClass()" aria-expanded="false" aria-controls="auth">
              <i class="mdi mdi-account menu-icon"></i>
              <span class="menu-title">班级管理</span>
              <i class="menu-arrow"></i>
            </a>

          </li>
        </ul>
      </nav>
      <!-- partial -->
     <div class="content-container">
  <div class="content-window">
    <div class="table-container">
      <div class="table-title" id="table-title">我的班级</div>
    <table id="dataTable">
      <thead>
        <tr>
          <th>班级名</th>
          <th>人数</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <!-- 初始的表格内容 -->
        <tr>
          <td><input type="checkbox" id="checkbox1" name="checkbox1">张三</td>
          <td>001</td>
          <td><button class="button-class" id="delete-class">删除</button><button class="button-class" id="refreshButton">详情</button></td>
        </tr>
        <!--内容示范，可更改-->
        <tr>
          <td><input type="checkbox" id="checkbox2" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox3" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox4" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox5" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox6" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox7" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox8" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox9" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
              <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
              <td>001</td>
              <td>1班</td>

        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <tr>
          <td><input type="checkbox" id="checkbox10" name="checkbox1">张三</td>
          <td>001</td>
          <td>1班</td>
        </tr>
        <!-- 其他行... -->
      </tbody>
    </table>
    </div>



  </div>
         <button id="newButton" class="control-button-right">我的班级</button>
      <!-- 触发弹窗的按钮 -->
         <button type="button" id="newClassButton">新建班级</button>
     </div>





    </div>
    <!-- page-body-wrapper ends -->

  </div>
  <!-- container-scroller -->
      <!-- 弹窗内容 -->
<div id="myModal" class="modal">
    <!-- 弹窗内部 -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <label for="classNameInput">班级名称:</label>
        <input type="text" id="classNameInput" name="className"><br><br>
        <!-- 拖拽区域 -->
        <div id="dropArea">将Excel文件拖拽到此处或 <label for="excelFileInput" class="file-label">点击上传</label></div>
        <input type="file" id="excelFileInput" style="display: none;"><br>
        <!-- 确定按钮 -->
        <button type="button" id="confirmButton">确定</button>
    </div>
</div>

 <!-- plugins:js -->
  <script type="text/javascript" src="{% static 'teacher_app/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <script type="text/javascript" src="{% static 'teacher_app/js/Chart.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'teacher_app/js/jquery.dataTables.js' %}"></script>
  <script type="text/javascript" src="{% static 'teacher_app/js/dataTables.bootstrap4.js' %}"></script>
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script type="text/javascript" src="{% static 'teacher_app/js/off-canvas.js' %}"></script>
  <script type="text/javascript" src="{% static 'teacher_app/js/hoverable-collapse.js' %}"></script>
  <script type="text/javascript" src="{% static 'teacher_app/js/template.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script type="text/javascript" src="{% static 'teacher_app/js/dashboard.js' %}"></script>
  <script type="text/javascript"  src="{% static 'teacher_app/js/data-table.js' %}"></script>
  <script type="text/javascript"  src="{% static 'teacher_app/js/jquery.dataTables(1).js' %}"></script>
  <script type="text/javascript" src="{% static 'teacher_app/js/dataTables.bootstrap4(1).js' %}"></script>
  <!-- End custom js for this page-->
  <script src="{% static 'teacher_app/js/jquery.cookie.js' %}" type="text/javascript"></script>
  <script>
/* 定义一个全局变量，稍后在 window.onload 中对其进行初始化8*/
var originalTableHTML;

function refreshTableContent() {
    // 更新表格标题
    var tableTitle = document.getElementById('table-title');
    if (tableTitle) {
        tableTitle.textContent = '班级详情'; // 更改为你想要的新标题
    }
    var table = document.getElementById('dataTable');
   var thead = table.getElementsByTagName('thead')[0];
    var tbody = table.getElementsByTagName('tbody')[0];
    // 清除现有的表格内容
     // 清除现有的 thead 和 tbody 内容
    thead.innerHTML = '';
    tbody.innerHTML = '';

    // 定义新的 thead 内容
    var newTheadData = ["姓名", "学号", "班级", "操作"];

    // 创建新的标题行
    var headerRow = thead.insertRow();
    newTheadData.forEach(function(headerText) {
        var headerCell = document.createElement("th");
        headerCell.textContent = headerText;
        headerRow.appendChild(headerCell);
    });
    // 定义新的 tbody 内容
    var newData = [
        ["张三", "001", "计算机1班"],
        ["李四", "002", "计算机2班"],
        // 更多行...
    ];

    // 为每一行新数据创建表格行和单元格
    newData.forEach(function(rowData) {
        var row = tbody.insertRow();
        rowData.forEach(function (cellData) {
            var cell = row.insertCell();
            cell.textContent = cellData;
        });
        // 在“操作”列添加“删除”和“重置密码”按钮
        var actionCell = row.insertCell();
        actionCell.innerHTML = '<button class="button-class" onclick="deleteRow(this)">删除</button>' +
                               '<button class="button-class" onclick="resetPassword(this)">重置密码</button>'
    });


        // 显示“返回初始”按钮
    document.getElementById('newButton').style.display = 'block';
    document.getElementById('newClassButton').style.display = 'none';

    // 由于刷新按钮可能被重新创建，确保再次绑定事件
    bindButtonEvents();
    addClass();
}

function bindDeleteButtonEvents() {
    // 由于每一行都可能有删除按钮，最好是用事件委托来绑定事件，而不是直接绑定到每个按钮上
    document.getElementById('dataTable').addEventListener('click', function(event) {
        // 检查点击的是否是删除按钮
        if (event.target && event.target.classList.contains('button-class')) {
            // 获取按钮所在的行（tr元素）
            var row = event.target.closest('tr');
            // 删除该行
            row.remove();
        }
    }, { once: true }); // 事件监听器在执行一次后会自动移除，确保每个删除按钮只能点击一次
}

function deleteRow(button) {
    var row = button.parentNode.parentNode; // 获取按钮所在的行
    row.parentNode.removeChild(row); // 从DOM中删除该行
}

function resetPassword(button) {
    var row = button.parentNode.parentNode; // 获取按钮所在的行
    var nameCell = row.cells[0]; // 假设姓名在第一列
    alert("重置 " + nameCell.textContent + " 的密码");
}

function addClass() {
    // 获取弹窗元素
    var modal = document.getElementById("myModal");

    // 获取打开弹窗的按钮元素
    var btn = document.getElementById("newClassButton");

    // 获取关闭按钮元素
    var span = document.getElementsByClassName("close")[0];

    // 当用户点击按钮时，打开弹窗
    btn.onclick = function () {
        modal.style.display = "block";
    }

    // 当用户点击 x 按钮时，关闭弹窗
    span.onclick = function () {
        modal.style.display = "none";
    }

    // 当用户点击弹窗外的区域时，关闭弹窗
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // 获取确定按钮元素
    var confirmBtn = document.getElementById("confirmButton");

    // 当用户点击确定按钮时，执行相关操作（例如收集数据等）并关闭弹窗
    confirmBtn.onclick = function () {
        // 获取班级名称输入字段的值
        var className = document.getElementById('classNameInput').value;

        // 获取文件输入元素并提取文件
        var fileInput = document.getElementById('excelFileInput');
        var file = fileInput.files[0];

        // 使用 FormData 对象封装数据
        var formData = new FormData();
        formData.append('className', className);
        formData.append('file', file);

        // 创建一个 XMLHttpRequest 对象
        var xhr = new XMLHttpRequest();

        // 配置请求类型，URL 以及异步处理的标志
        xhr.open('POST', 'your-backend-url', true);

        // 定义当请求完成时的处理函数
        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
                // 请求成功，可以处理响应数据
                console.log('Success:', xhr.responseText);
            } else {
                // 请求失败，处理错误状态
                console.log('Error:', xhr.statusText);
            }

            // 不管成功或失败，都关闭弹窗
            modal.style.display = 'none';
        };

        // 发送请求，携带 FormData 数据
        xhr.send(formData);


        // 在 addClass 函数内部或作为单独的函数添加
// 获取拖拽区域元素
var dropArea = document.getElementById('dropArea');

// 阻止默认行为（如打开文件）
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  dropArea.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

// 高亮拖拽区域
['dragenter', 'dragover'].forEach(eventName => {
  dropArea.addEventListener(eventName, highlight, false);
});

// 取消高亮
['dragleave', 'drop'].forEach(eventName => {
  dropArea.addEventListener(eventName, unhighlight, false);
});

    };
}

// 使用事件委托监听按钮点击
function bindButtonEvents() {
    // 绑定刷新按钮事件
    document.getElementById('refreshButton').addEventListener('click', refreshTableContent);

    // 绑定返回初始按钮事件
    document.getElementById('newButton').addEventListener('click', function () {
        // 使用原始HTML恢复表格
        document.getElementById('dataTable').innerHTML = originalTableHTML;
        // 隐藏返回初始按钮
        this.style.display = 'none';
        document.getElementById('newClassButton').style.display = 'block';
    });

    document.getElementById('dataTable').addEventListener('click', function (event) {
        // 检查是否点击了刷新按钮
        if (event.target.id === 'refreshButton') {
            refreshTableContent();
        }
        // 检查是否点击了返回初始按钮
        else if (event.target.id === 'newButton') {
            // 使用原始HTML恢复表格
            document.getElementById('dataTable').innerHTML = originalTableHTML;
            // 隐藏返回初始按钮
            event.target.style.display = 'none';
        }
    });
}

// 确保在页面加载完成后调用函数以设置事件监听器
window.onload = function() {
    originalTableHTML = document.getElementById('dataTable').innerHTML;
    bindButtonEvents(); // 初始绑定
    addClass();
    bindDeleteButtonEvents();
}
  </script>


</body></html>